// Load a remote file in order to capture flag

var http = require('http');
var filesystem = require('fs');
var p = require('path');

var express = require('express');
var dvna = express();

// TODO: Handle ENOENT error exception when the flag isn't loaded as this will crash node otherwise
dvna.get('/vulnerable', function(req, res){
  try {
    debugger
    var filePath = p.join(__dirname, '/' + req.query.traverse);
    var readStream = filesystem.createReadStream(filePath);
    readStream.pipe(res);
  } catch (e) {
    res.send(404);
    console.log('File not found');
  }
});

module.exports = {
  title: 'Directory Traversal',
  server: dvna
}
